<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/default_layout">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!--  부트스트랩 css 사용 -->
<link rel="stylesheet" type="text/css" th:href="@{/CSS/bootstrap.css}">
<!--  부트스트랩 css 사용 -->

<script src="https://code.jquery.com/jquery-3.4.1.js"></script>

<script type="text/javascript" th:src="@{/JS/common.js}"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
<!--  부트스트랩 js 사용 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" th:src="@{/JS/bootstrap.js}"></script>
<!--  부트스트랩 js 사용 -->
<script type="text/javascript" th:src="@{/JS/stockManage.js}"></script>
<script type="text/javascript">
</script>
<script th:inline="javascript">
const colors = ['red','yellow','blue','#c3e6cb','#dc3545','#6c757d'];
var chartData = {
	   
	  };
var  datasets = [{
    data: [589, 445, 483, 503, 689, 692, 634],
    backgroundColor: colors[0]
    },
    {
      data: [209, 245, 383, 403, 589, 692, 580],
      backgroundColor: colors[1]
    },
    {
      data: [489, 135, 483, 290, 189, 603, 600],
      backgroundColor: colors[2]
    },
    {
      data: [639, 465, 493, 478, 589, 632, 674],
      backgroundColor: colors[4]
    }]
window.addEventListener('DOMContentLoaded', function(){
	let value = /*[[${stockManageDto}]]*/ 'default';
	//alert(varule);
	let  data = [30, 40, 20, 50, 80, 90, 20];
	const stock_name_array = [];
	const shares_array = [];
	const backgroundColor = [];
	const dataArray = [];
	for(var key = 0; key < value.length; key++){
	let stock_dividends = [];
	const dataVlue_2 = {};
	
		stock_name_array.unshift(value[key].stock_name);	
		shares_array.unshift(value[key].shares);
		backgroundColor.unshift(generateRandomCode());
		//stock_dividends = [01,02,03,04,05,06,07,08,09,10,11,12];
	switch (value[key].stock_dividends) {
	  case '01,04,07,10':
		stock_dividends = [
			Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			0,
			0,
			Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			0,
			0,
			Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			0,
			0,
			Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			0,
			0
		];
	   break;
	  case '02,05,08,11':
		  stock_dividends = [
			  0,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,,
			  0,
			  0,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  0,
			  0,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  0,
			  0,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  0
			 ];
		   break;
	  case '04':
		  stock_dividends = [
			  0,
			  0,
			  0,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  0,
			  0,
			  0,
			  0,
			  0,
			  0,
			  0,
			  0
			];
		   break;	   
	  case '03,06,09,12':
		  stock_dividends = [
			  0,
			  0,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  0,
			  0,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  0,
			  0,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  0,
			  0,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100
			];
		   break;
	  case '월':
		  stock_dividends = [
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100,
			  Math.ceil((value[key].shares * value[key].dividends)*100)/100
			 ];
		   break;	
	  case '04,07,10,12':
			stock_dividends = [
				0,
				0,
				0,
				Math.ceil((value[key].shares * value[key].dividends)*100)/100,
				0,
				0,
				Math.ceil((value[key].shares * value[key].dividends)*100)/100,
				0,
				0,
				Math.ceil((value[key].shares * value[key].dividends)*100)/100,
				0,
				Math.ceil((value[key].shares * value[key].dividends)*100)/100
			];
		   break;	
	  default:
	    //alert( "어떤 값인지 파악이 되지 않습니다." );
	}	// switch end
		//console.log(stock_dividends);
		//stock_dividends = null;
		dataVlue_2.data = stock_dividends;
		dataVlue_2.label = value[key].stock_name;
		dataVlue_2.backgroundColor = generateRandomCode();
		dataArray.push(dataVlue_2,stock_name_array);

	}// for end
	
	test(stock_name_array,shares_array,backgroundColor);
	test3(dataArray,stock_name_array);
	
	
})
// 파이  차트 만들기
function test(stock_name_array,shares_array,backgroundColor){
	 const ctx = document.getElementById("pie_chart").getContext('2d');
     const myChart = new Chart(ctx, {
       type: 'doughnut',
       data: {
         labels: stock_name_array,
         datasets: [{
           label: 'food Items',
           backgroundColor: backgroundColor,
           //borderColor: 'rgb(47, 128, 237)',
           data: shares_array,
	        text: '년도 배당금 차트'
         }]
       },
     });
}

//막대 차드
function test3(dataArray,stock_name_array){
	const colors = ['red','yellow','blue','#c3e6cb','#dc3545','#6c757d'];
	var chBar = document.getElementById("bar_chart");
	  var chartData = {
	    labels: ["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월",],
	    datasets: dataArray
	  };
	  var myChart = new Chart(chBar, {
	    // 챠트 종류를 선택
	    type: 'bar',

	    // 챠트를 그릴 데이타
	    data: chartData,

	    // 옵션
	    options: {
	      legend: {
	        display: false,
	        text: '년도 배당금 차트'
	      }
	    }
	  });
}

function test2(){
	const colors = ['red','yellow','blue','#c3e6cb','#dc3545','#6c757d'];
	var chBar = document.getElementById("bar_chart");
	  var chartData = {
	    labels: ["S", "M", "T", "W", "T", "F", "S"],
	    datasets: [{
	    data: [589, 445, 483, 503, 689, 692, 634],
	    backgroundColor: colors[0]
	    },
	    {
	      data: [209, 245, 383, 403, 589, 692, 580],
	      backgroundColor: colors[1]
	    },
	    {
	      data: [489, 135, 483, 290, 189, 603, 600],
	      backgroundColor: colors[2]
	    },
	    {
	      data: [639, 465, 493, 478, 589, 632, 674],
	      backgroundColor: colors[4]
	    }]
	  };
	  var myChart = new Chart(chBar, {
	    // 챠트 종류를 선택
	    type: 'bar',

	    // 챠트를 그릴 데이타
	    data: chartData,

	    // 옵션
	    options: {
	      legend: {
	        display: false
	      }
	    }
	  });
}

// 임의 색상 지정
function generateRandomCode() {
    var myRandomColor = '#'+Math.floor(Math.random()*16777215).toString(16);
     return myRandomColor;
  }
</script>
</head>
<body>
  <th:block layout:fragment="content">
  	<h2>주식 통합 관리</h2>
	<div >
		<form th:action="@{/stockManageInsert.do}" th:object="${stockManage}" method="post">
				<table >
				<thead>
					<tr>
						<th>주식명</th>
						<th>수량</th>
						<th>배당 주기</th>
						<th>매입금(달러)</th>
						<th>배당금(달러)</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
						<tr>
						<td><input type="text" th:field="*{stock_name}"  class="form-control"></td>
						<td><input type="text" th:field="*{shares}" class="form-control"></td>
						<td><input type="text" th:field="*{stock_dividends}" class="form-control"></td>
						<td><input type="text" th:field="*{maeipkkeum}" class="form-control"></td>
						<td><input type="text" th:field="*{dividends}" class="form-control"></td>
						<td><button type="submit" class="btn btn-light">추가</button></td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<div style=" float: le">
	<table class="table table-hover">
		<thead>
			<tr>
				<!-- <th  style="display: none;">주식명</th> -->
				<th>주식명</th>
				<th>수정/삭제</th>
				<th>수량</th>
				<th>배당 주기</th>
				<th>매입금(달러)</th>
				<th>배당금(달러)</th>
				<th>예상 배당금</th>
				<th>1월</th>
				<th>2월</th>
				<th>3월</th>
				<th>4월</th>
				<th>5월</th>
				<th>6월</th>
				<th>7월</th>
				<th>8월</th>
				<th>9월</th>
				<th>10월</th>
				<th>11월</th>
				<th>12월</th>
			</tr>
		</thead>
		<tbody>
		<th:block th:each="stockManageDto: ${stockManageDto}"> 
			<tr>
			<!-- <td th:text="${stockManageDto.registration_order}" style="display: none;"> </td> --> <!-- 주식명 -->
			<td th:text="${stockManageDto.stock_name}"> </td> <!-- 주식명 -->
			<td >
				<button type="button" class="btn btn-outline-success" th:onclick="openPopUpdate([[${stockManageDto}]]);">수정</button> /
				<button type="button" class="btn btn-outline-danger"  th:onclick="openPopDelete([[${stockManageDto}]]);">삭제</button>
			</td> <!-- 주식명 -->
			<td th:text="${stockManageDto.shares}"></td> <!-- 주식수 -->
			<td th:text="${stockManageDto.stock_dividends}"></td> <!-- 주식 주기 -->
			<td th:text="${stockManageDto.maeipkkeum}"></td> <!-- 매입금(달러) -->
			<td th:text="${stockManageDto.dividends}" ></td> <!-- 배당금(달러) -->
			
			<td th:text="${stockManageDto.shares} * ${stockManageDto.dividends}"></td> <!-- 배당금(달러) -->
			
			
			<th:block th:if="${!#strings.contains(stockManageDto.stock_dividends, '월')}">
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '01')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '01')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '02')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '02')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '03')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '03')}">X</td>
			
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '04')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '04')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '05')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '05')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '06')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '06')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '07')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '07')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '08')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '08')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '09')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '09')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '10')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '10')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '11')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '11')}">X</td>
			
			<td th:if="${#strings.contains(stockManageDto.stock_dividends, '12')}">O</td> 
			<td th:unless="${#strings.contains(stockManageDto.stock_dividends, '12')}">X</td>
			</th:block>
			
			<th:block th:if="${#strings.contains(stockManageDto.stock_dividends, '월')}">
				<td >O</td>
				<td >O</td>
				<td >O</td> 
				<td >O</td>
				<td >O</td>
				<td >O</td>
				<td >O</td>
				<td >O</td>
				<td >O</td>
				<td >O</td>
				<td >O</td>
				<td >O</td>
			</th:block>
			</tr>
		</th:block>
		</tbody>
	</table>
	</div>
	
	<!-- 모달창 -->
	<div class="modal fade" id="testModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">모달테스트</h5>
					<button class="close" type="button" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">X</span>
					</button>
				</div>
				<div class="modal-body">주식명 
				<input type="text" class="form-control" id="new_stock_name" name="new_stock_name" readonly>
				</div>
				<div class="modal-body">수량
				<input type="text" class="form-control" id="new_shares" name="new_shares"></div>
				<div class="modal-body">배당 주기
				<input type="text" class="form-control" id="new_stock_dividends" name="new_stock_dividends"></div>
				<div class="modal-body">매입금(달러)
				<input type="text" class="form-control" id="new_maeipkkeum" name="new_maeipkkeum"></div>
				<div class="modal-body">배당금(달러)
				<input type="text" class="form-control" id="new_dividends" name="new_dividends"></div>
				<div class="modal-footer">
					<button type="button" id="btn-outline-success" class="btn btn-outline-success" th:onclick="stockManageUpdate();">수정</button>
					<button type="button" id="btn-outline-danger" class="btn btn-outline-danger"  th:onclick="stockManageDelete();">삭제</button>
					<button class="btn btn-secondary" type="button" data-dismiss="modal">아니요</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 모달창 -->
	<div class="row">
	<!--  파이 차트 -->
	<div class="card chart-container col">
	    <canvas id="pie_chart" ></canvas>
	  </div>
	<!--  파이 차트 -->
	
	<!-- 막대 차트 -->
	<div class="card chart-container col">
	    <canvas id="bar_chart" ></canvas>
	  </div>
	<!-- 막대 차트 -->	
	</div>
  </th:block>

</body>
</html>